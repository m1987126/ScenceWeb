# -*- coding: utf-8 -*-"""Created on Sat Nov  3 20:29:48 2018@author: Administrator"""import requestsimport jsonimport reimport importlibfrom urllib.parse import urlencode"景区实时客流量数据"class GetJINGQU(object):    instance = None    instance_flag = False    def __new__(cls, *args, **kwargs):        if not cls.instance:            cls.instance = super().__new__(cls)            print("new")        return cls.instance    def __init__(self):        if not GetJINGQU.instance_flag:            GetJINGQU.instance_flag = True            self.headers = {                'Host': 'jiaotong.baidu.com',                'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) '                              'Chrome/55.0.2883.87 UBrowser/6.2.4094.1 Safari/537.36'            }            self.s = requests.Session()            self.Database = importlib.import_module("Scenic.models")    # 获取地理信息    def get_geographic_information(self, pid):        h = 'http://jiaotong.baidu.com/trafficindex/dashboard/arealist?'        u = {            'type': '1',            'area_type': '1',            'admin_code': pid        }        url = h + urlencode(u)        data = self.s.get(url=url, headers=self.headers)        try:            g = json.loads(data.text)        except Exception as e:            print("%s：正则匹配格式有误，更正" % e)            p = re.compile("\((.*?)\)", re.S)            data = re.search(p, data.text)            g = json.loads(data.group(1))        for item in g['data']['list']:            result = list()            name = item['display_name']            pid = item['area_id']            location = item['location'].split(',')            lon = location[0]  # 地理经度            lat = location[1]  # 地理纬度            result.append(name)  # 景区名字            result.append(pid)  # pid            result.append(lon)            result.append(lat)            yield resultclass Information(object):    def __init__(self, pid, name, citycode, weatherpid):        self.pid = pid        self.jingquname = name  # 景区名字        self.citycode = citycode        self.Weatherpid = weatherpid    def getinformation(self):        return self